fb7b3b96169fc9a06589d7e83797f871
/**
 * Enhanced Assertion System
 * 
 * This module provides a comprehensive assertion system for validating LLM outputs
 * with support for semantic similarity, custom JavaScript code execution, and
 * various other advanced validation techniques.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get AssertionEngine () {
        return _AssertionEngine.AssertionEngine;
    },
    get AssertionTypeRegistry () {
        return _AssertionTypeRegistry.AssertionTypeRegistry;
    },
    get AssertionUtils () {
        return AssertionUtils;
    },
    get CustomAssertionValidator () {
        return _CustomAssertionValidator.CustomAssertionValidator;
    },
    get SemanticSimilarityValidator () {
        return _SemanticSimilarityValidator.SemanticSimilarityValidator;
    },
    get assertionEngine () {
        return assertionEngine;
    },
    get // Export as default
    default () {
        return _default;
    }
});
const _AssertionEngine = require("./AssertionEngine");
const _SemanticSimilarityValidator = require("./SemanticSimilarityValidator");
const _CustomAssertionValidator = require("./CustomAssertionValidator");
const _AssertionTypeRegistry = require("./AssertionTypeRegistry");
class AssertionUtils {
    /**
   * Create a basic contains assertion
   */ static contains(value, description) {
        return {
            type: 'contains',
            value,
            description: description || `Check if output contains "${value}"`
        };
    }
    /**
   * Create a length range assertion
   */ static lengthRange(min, max, description) {
        return {
            type: 'length',
            value: `${min}-${max}`,
            description: description || `Check if output length is between ${min} and ${max} characters`
        };
    }
    /**
   * Create a semantic similarity assertion
   */ static semanticSimilarity(expectedText, threshold = 0.8, description) {
        return {
            type: 'semantic-similarity',
            value: expectedText,
            threshold,
            description: description || `Check semantic similarity to "${expectedText}" (threshold: ${threshold})`
        };
    }
    /**
   * Create a sentiment assertion
   */ static sentiment(expectedSentiment, threshold = 0.6, description) {
        return {
            type: 'sentiment',
            value: expectedSentiment,
            threshold,
            description: description || `Check if sentiment is ${expectedSentiment} (threshold: ${threshold})`
        };
    }
    /**
   * Create a language detection assertion
   */ static language(expectedLanguage, description) {
        return {
            type: 'language',
            value: expectedLanguage,
            description: description || `Check if language is ${expectedLanguage}`
        };
    }
    /**
   * Create a toxicity assertion
   */ static toxicity(maxScore = 0.5, description) {
        return {
            type: 'toxicity',
            value: maxScore,
            description: description || `Check if toxicity score is below ${maxScore}`
        };
    }
    /**
   * Create a custom assertion with helper functions
   */ static custom(code, description) {
        return {
            type: 'custom',
            value: code,
            description: description || 'Custom assertion validation'
        };
    }
    /**
   * Create a JSON schema assertion
   */ static jsonSchema(schema, description) {
        return {
            type: 'json-schema',
            value: schema,
            description: description || 'Validate JSON structure'
        };
    }
    /**
   * Create a regex assertion
   */ static regex(pattern, flags, description) {
        return {
            type: 'regex',
            value: pattern,
            config: flags ? {
                flags
            } : undefined,
            description: description || `Check if output matches pattern: ${pattern}`
        };
    }
    /**
   * Create multiple assertions for comprehensive validation
   */ static comprehensive(expectedText, options = {}) {
        const assertions = [];
        // Semantic similarity
        if (options.semanticThreshold !== undefined) {
            assertions.push(this.semanticSimilarity(expectedText, options.semanticThreshold));
        }
        // Sentiment
        if (options.sentimentExpected) {
            assertions.push(this.sentiment(options.sentimentExpected));
        }
        // Length constraints
        if (options.minLength !== undefined && options.maxLength !== undefined) {
            assertions.push(this.lengthRange(options.minLength, options.maxLength));
        }
        // Language
        if (options.language) {
            assertions.push(this.language(options.language));
        }
        // Toxicity
        if (options.maxToxicity !== undefined) {
            assertions.push(this.toxicity(options.maxToxicity));
        }
        // Custom checks
        if (options.customChecks) {
            options.customChecks.forEach((check)=>{
                assertions.push(this.custom(check));
            });
        }
        return assertions;
    }
}
const assertionEngine = new _AssertionEngine.AssertionEngine();
// Initialize the global assertion engine
assertionEngine.initialize().catch(console.error);
const _default = assertionEngine;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL3Byb21wdC1jYXJkLXN5c3RlbS9iYWNrZW5kL3NyYy9zZXJ2aWNlcy9hc3NlcnRpb25zL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5oYW5jZWQgQXNzZXJ0aW9uIFN5c3RlbVxuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBhIGNvbXByZWhlbnNpdmUgYXNzZXJ0aW9uIHN5c3RlbSBmb3IgdmFsaWRhdGluZyBMTE0gb3V0cHV0c1xuICogd2l0aCBzdXBwb3J0IGZvciBzZW1hbnRpYyBzaW1pbGFyaXR5LCBjdXN0b20gSmF2YVNjcmlwdCBjb2RlIGV4ZWN1dGlvbiwgYW5kXG4gKiB2YXJpb3VzIG90aGVyIGFkdmFuY2VkIHZhbGlkYXRpb24gdGVjaG5pcXVlcy5cbiAqL1xuXG5leHBvcnQgeyBcbiAgQXNzZXJ0aW9uRW5naW5lXG59IGZyb20gJy4vQXNzZXJ0aW9uRW5naW5lJztcblxuZXhwb3J0IHR5cGUgeyBcbiAgRW5oYW5jZWRBc3NlcnRpb25UeXBlLFxuICBFbmhhbmNlZEFzc2VydGlvblJlc3VsdCxcbiAgQXNzZXJ0aW9uQ29udGV4dFxufSBmcm9tICcuL0Fzc2VydGlvbkVuZ2luZSc7XG5cbmV4cG9ydCB7IFxuICBTZW1hbnRpY1NpbWlsYXJpdHlWYWxpZGF0b3IsXG4gIHR5cGUgU2ltaWxhcml0eVJlc3VsdCxcbiAgdHlwZSBTZW50aW1lbnRSZXN1bHQsXG4gIHR5cGUgTGFuZ3VhZ2VSZXN1bHQsXG4gIHR5cGUgVG94aWNpdHlSZXN1bHRcbn0gZnJvbSAnLi9TZW1hbnRpY1NpbWlsYXJpdHlWYWxpZGF0b3InO1xuXG5leHBvcnQgeyBcbiAgQ3VzdG9tQXNzZXJ0aW9uVmFsaWRhdG9yLFxuICB0eXBlIEN1c3RvbUFzc2VydGlvblJlc3VsdFxufSBmcm9tICcuL0N1c3RvbUFzc2VydGlvblZhbGlkYXRvcic7XG5cbmV4cG9ydCB7IFxuICBBc3NlcnRpb25UeXBlUmVnaXN0cnksXG4gIHR5cGUgQXNzZXJ0aW9uVmFsaWRhdG9yLFxuICB0eXBlIEFzc2VydGlvblR5cGVEZWZpbml0aW9uLFxuICB0eXBlIEFzc2VydGlvbkV4ZWN1dGlvblN0YXRzXG59IGZyb20gJy4vQXNzZXJ0aW9uVHlwZVJlZ2lzdHJ5JztcblxuLyoqXG4gKiBFbmhhbmNlZCBBc3NlcnRpb24gU3lzdGVtIEZlYXR1cmVzOlxuICogXG4gKiAxLiAqKkJhc2ljIEFzc2VydGlvbnMqKjogY29udGFpbnMsIG5vdC1jb250YWlucywgZXF1YWxzLCBub3QtZXF1YWxzLCByZWdleCwgbGVuZ3RoXG4gKiAyLiAqKlNlbWFudGljIFNpbWlsYXJpdHkqKjogQ29tcGFyZSB0ZXh0IG1lYW5pbmcgdXNpbmcgVEYtSURGIHNpbWlsYXJpdHlcbiAqIDMuICoqQ3VzdG9tIEFzc2VydGlvbnMqKjogRXhlY3V0ZSBzZWN1cmUgSmF2YVNjcmlwdCBjb2RlIGZvciBjb21wbGV4IHZhbGlkYXRpb25zXG4gKiA0LiAqKkpTT04gU2NoZW1hKio6IFZhbGlkYXRlIEpTT04gc3RydWN0dXJlIGFuZCBjb250ZW50XG4gKiA1LiAqKlNlbnRpbWVudCBBbmFseXNpcyoqOiBEZXRlY3QgcG9zaXRpdmUsIG5lZ2F0aXZlLCBvciBuZXV0cmFsIHNlbnRpbWVudFxuICogNi4gKipMYW5ndWFnZSBEZXRlY3Rpb24qKjogSWRlbnRpZnkgdGV4dCBsYW5ndWFnZSBhdXRvbWF0aWNhbGx5XG4gKiA3LiAqKlRveGljaXR5IERldGVjdGlvbioqOiBDaGVjayBmb3IgaW5hcHByb3ByaWF0ZSBvciBoYXJtZnVsIGNvbnRlbnRcbiAqIDguICoqUGVyZm9ybWFuY2UgVHJhY2tpbmcqKjogTW9uaXRvciBleGVjdXRpb24gdGltZSBhbmQgc3VjY2VzcyByYXRlc1xuICogOS4gKipUeXBlIFJlZ2lzdHJ5Kio6IE1hbmFnZSBhbmQgZXh0ZW5kIGFzc2VydGlvbiB0eXBlcyBkeW5hbWljYWxseVxuICogMTAuICoqU2VjdXJpdHkqKjogU2FuZGJveGVkIGV4ZWN1dGlvbiBlbnZpcm9ubWVudCBmb3IgY3VzdG9tIGNvZGVcbiAqIFxuICogVXNhZ2UgRXhhbXBsZXM6XG4gKiBcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7IGFzc2VydGlvbkVuZ2luZSwgRW5oYW5jZWRBc3NlcnRpb25UeXBlIH0gZnJvbSAnLi9hc3NlcnRpb25zJztcbiAqIFxuICogLy8gSW5pdGlhbGl6ZSB0aGUgZW5naW5lXG4gKiBhd2FpdCBhc3NlcnRpb25FbmdpbmUuaW5pdGlhbGl6ZSgpO1xuICogXG4gKiAvLyBCYXNpYyBhc3NlcnRpb25cbiAqIGNvbnN0IGJhc2ljQXNzZXJ0aW9uOiBFbmhhbmNlZEFzc2VydGlvblR5cGUgPSB7XG4gKiAgIHR5cGU6ICdjb250YWlucycsXG4gKiAgIHZhbHVlOiAnaGVsbG8nXG4gKiB9O1xuICogXG4gKiAvLyBTZW1hbnRpYyBzaW1pbGFyaXR5XG4gKiBjb25zdCBzZW1hbnRpY0Fzc2VydGlvbjogRW5oYW5jZWRBc3NlcnRpb25UeXBlID0ge1xuICogICB0eXBlOiAnc2VtYW50aWMtc2ltaWxhcml0eScsXG4gKiAgIHZhbHVlOiAnVGhlIHdlYXRoZXIgaXMgbmljZScsXG4gKiAgIHRocmVzaG9sZDogMC44XG4gKiB9O1xuICogXG4gKiAvLyBDdXN0b20gYXNzZXJ0aW9uXG4gKiBjb25zdCBjdXN0b21Bc3NlcnRpb246IEVuaGFuY2VkQXNzZXJ0aW9uVHlwZSA9IHtcbiAqICAgdHlwZTogJ2N1c3RvbScsXG4gKiAgIHZhbHVlOiAncmV0dXJuIG91dHB1dC5sZW5ndGggPiAxMCAmJiB3b3JkQ291bnQgPiAyJ1xuICogfTtcbiAqIFxuICogLy8gVmFsaWRhdGUgYXNzZXJ0aW9uc1xuICogY29uc3QgcmVzdWx0cyA9IGF3YWl0IGFzc2VydGlvbkVuZ2luZS52YWxpZGF0ZUFzc2VydGlvbnMoXG4gKiAgICdIZWxsbyB3b3JsZCEnLFxuICogICBbYmFzaWNBc3NlcnRpb24sIHNlbWFudGljQXNzZXJ0aW9uLCBjdXN0b21Bc3NlcnRpb25dXG4gKiApO1xuICogYGBgXG4gKi9cblxuLy8gUmUtZXhwb3J0IHR5cGVzIGZyb20gdGVzdENhc2UgZm9yIGNvbnZlbmllbmNlXG5leHBvcnQgdHlwZSB7IEFzc2VydGlvblR5cGUgfSBmcm9tICcuLi8uLi90eXBlcy90ZXN0Q2FzZSc7XG5leHBvcnQgdHlwZSB7IEFzc2VydGlvblJlc3VsdCB9IGZyb20gJy4uLy4uL3R5cGVzL3Rlc3RFeGVjdXRpb24nO1xuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgY29tbW9uIGFzc2VydGlvbiBwYXR0ZXJuc1xuaW1wb3J0IHsgRW5oYW5jZWRBc3NlcnRpb25UeXBlIH0gZnJvbSAnLi9Bc3NlcnRpb25FbmdpbmUnO1xuXG5leHBvcnQgY2xhc3MgQXNzZXJ0aW9uVXRpbHMge1xuICAvKipcbiAgICogQ3JlYXRlIGEgYmFzaWMgY29udGFpbnMgYXNzZXJ0aW9uXG4gICAqL1xuICBzdGF0aWMgY29udGFpbnModmFsdWU6IHN0cmluZywgZGVzY3JpcHRpb24/OiBzdHJpbmcpOiBFbmhhbmNlZEFzc2VydGlvblR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnY29udGFpbnMnLFxuICAgICAgdmFsdWUsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYENoZWNrIGlmIG91dHB1dCBjb250YWlucyBcIiR7dmFsdWV9XCJgXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBsZW5ndGggcmFuZ2UgYXNzZXJ0aW9uXG4gICAqL1xuICBzdGF0aWMgbGVuZ3RoUmFuZ2UobWluOiBudW1iZXIsIG1heDogbnVtYmVyLCBkZXNjcmlwdGlvbj86IHN0cmluZyk6IEVuaGFuY2VkQXNzZXJ0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdsZW5ndGgnLFxuICAgICAgdmFsdWU6IGAke21pbn0tJHttYXh9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB8fCBgQ2hlY2sgaWYgb3V0cHV0IGxlbmd0aCBpcyBiZXR3ZWVuICR7bWlufSBhbmQgJHttYXh9IGNoYXJhY3RlcnNgXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzZW1hbnRpYyBzaW1pbGFyaXR5IGFzc2VydGlvblxuICAgKi9cbiAgc3RhdGljIHNlbWFudGljU2ltaWxhcml0eShcbiAgICBleHBlY3RlZFRleHQ6IHN0cmluZywgXG4gICAgdGhyZXNob2xkOiBudW1iZXIgPSAwLjgsIFxuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gICk6IEVuaGFuY2VkQXNzZXJ0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdzZW1hbnRpYy1zaW1pbGFyaXR5JyxcbiAgICAgIHZhbHVlOiBleHBlY3RlZFRleHQsXG4gICAgICB0aHJlc2hvbGQsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYENoZWNrIHNlbWFudGljIHNpbWlsYXJpdHkgdG8gXCIke2V4cGVjdGVkVGV4dH1cIiAodGhyZXNob2xkOiAke3RocmVzaG9sZH0pYFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc2VudGltZW50IGFzc2VydGlvblxuICAgKi9cbiAgc3RhdGljIHNlbnRpbWVudChcbiAgICBleHBlY3RlZFNlbnRpbWVudDogJ3Bvc2l0aXZlJyB8ICduZWdhdGl2ZScgfCAnbmV1dHJhbCcsXG4gICAgdGhyZXNob2xkOiBudW1iZXIgPSAwLjYsXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgKTogRW5oYW5jZWRBc3NlcnRpb25UeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3NlbnRpbWVudCcsXG4gICAgICB2YWx1ZTogZXhwZWN0ZWRTZW50aW1lbnQsXG4gICAgICB0aHJlc2hvbGQsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYENoZWNrIGlmIHNlbnRpbWVudCBpcyAke2V4cGVjdGVkU2VudGltZW50fSAodGhyZXNob2xkOiAke3RocmVzaG9sZH0pYFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbGFuZ3VhZ2UgZGV0ZWN0aW9uIGFzc2VydGlvblxuICAgKi9cbiAgc3RhdGljIGxhbmd1YWdlKGV4cGVjdGVkTGFuZ3VhZ2U6IHN0cmluZywgZGVzY3JpcHRpb24/OiBzdHJpbmcpOiBFbmhhbmNlZEFzc2VydGlvblR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnbGFuZ3VhZ2UnLFxuICAgICAgdmFsdWU6IGV4cGVjdGVkTGFuZ3VhZ2UsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYENoZWNrIGlmIGxhbmd1YWdlIGlzICR7ZXhwZWN0ZWRMYW5ndWFnZX1gXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSB0b3hpY2l0eSBhc3NlcnRpb25cbiAgICovXG4gIHN0YXRpYyB0b3hpY2l0eShtYXhTY29yZTogbnVtYmVyID0gMC41LCBkZXNjcmlwdGlvbj86IHN0cmluZyk6IEVuaGFuY2VkQXNzZXJ0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICd0b3hpY2l0eScsXG4gICAgICB2YWx1ZTogbWF4U2NvcmUsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgYENoZWNrIGlmIHRveGljaXR5IHNjb3JlIGlzIGJlbG93ICR7bWF4U2NvcmV9YFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY3VzdG9tIGFzc2VydGlvbiB3aXRoIGhlbHBlciBmdW5jdGlvbnNcbiAgICovXG4gIHN0YXRpYyBjdXN0b20oY29kZTogc3RyaW5nLCBkZXNjcmlwdGlvbj86IHN0cmluZyk6IEVuaGFuY2VkQXNzZXJ0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdjdXN0b20nLFxuICAgICAgdmFsdWU6IGNvZGUsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgJ0N1c3RvbSBhc3NlcnRpb24gdmFsaWRhdGlvbidcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIEpTT04gc2NoZW1hIGFzc2VydGlvblxuICAgKi9cbiAgc3RhdGljIGpzb25TY2hlbWEoc2NoZW1hOiBvYmplY3QsIGRlc2NyaXB0aW9uPzogc3RyaW5nKTogRW5oYW5jZWRBc3NlcnRpb25UeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ2pzb24tc2NoZW1hJyxcbiAgICAgIHZhbHVlOiBzY2hlbWEsXG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgJ1ZhbGlkYXRlIEpTT04gc3RydWN0dXJlJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgcmVnZXggYXNzZXJ0aW9uXG4gICAqL1xuICBzdGF0aWMgcmVnZXgocGF0dGVybjogc3RyaW5nLCBmbGFncz86IHN0cmluZywgZGVzY3JpcHRpb24/OiBzdHJpbmcpOiBFbmhhbmNlZEFzc2VydGlvblR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAncmVnZXgnLFxuICAgICAgdmFsdWU6IHBhdHRlcm4sXG4gICAgICBjb25maWc6IGZsYWdzID8geyBmbGFncyB9IDogdW5kZWZpbmVkLFxuICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIHx8IGBDaGVjayBpZiBvdXRwdXQgbWF0Y2hlcyBwYXR0ZXJuOiAke3BhdHRlcm59YFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIG11bHRpcGxlIGFzc2VydGlvbnMgZm9yIGNvbXByZWhlbnNpdmUgdmFsaWRhdGlvblxuICAgKi9cbiAgc3RhdGljIGNvbXByZWhlbnNpdmUoXG4gICAgZXhwZWN0ZWRUZXh0OiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgc2VtYW50aWNUaHJlc2hvbGQ/OiBudW1iZXI7XG4gICAgICBzZW50aW1lbnRFeHBlY3RlZD86ICdwb3NpdGl2ZScgfCAnbmVnYXRpdmUnIHwgJ25ldXRyYWwnO1xuICAgICAgbWluTGVuZ3RoPzogbnVtYmVyO1xuICAgICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgICAgbGFuZ3VhZ2U/OiBzdHJpbmc7XG4gICAgICBtYXhUb3hpY2l0eT86IG51bWJlcjtcbiAgICAgIGN1c3RvbUNoZWNrcz86IHN0cmluZ1tdO1xuICAgIH0gPSB7fVxuICApOiBFbmhhbmNlZEFzc2VydGlvblR5cGVbXSB7XG4gICAgY29uc3QgYXNzZXJ0aW9uczogRW5oYW5jZWRBc3NlcnRpb25UeXBlW10gPSBbXTtcblxuICAgIC8vIFNlbWFudGljIHNpbWlsYXJpdHlcbiAgICBpZiAob3B0aW9ucy5zZW1hbnRpY1RocmVzaG9sZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBhc3NlcnRpb25zLnB1c2godGhpcy5zZW1hbnRpY1NpbWlsYXJpdHkoZXhwZWN0ZWRUZXh0LCBvcHRpb25zLnNlbWFudGljVGhyZXNob2xkKSk7XG4gICAgfVxuXG4gICAgLy8gU2VudGltZW50XG4gICAgaWYgKG9wdGlvbnMuc2VudGltZW50RXhwZWN0ZWQpIHtcbiAgICAgIGFzc2VydGlvbnMucHVzaCh0aGlzLnNlbnRpbWVudChvcHRpb25zLnNlbnRpbWVudEV4cGVjdGVkKSk7XG4gICAgfVxuXG4gICAgLy8gTGVuZ3RoIGNvbnN0cmFpbnRzXG4gICAgaWYgKG9wdGlvbnMubWluTGVuZ3RoICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5tYXhMZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgYXNzZXJ0aW9ucy5wdXNoKHRoaXMubGVuZ3RoUmFuZ2Uob3B0aW9ucy5taW5MZW5ndGgsIG9wdGlvbnMubWF4TGVuZ3RoKSk7XG4gICAgfVxuXG4gICAgLy8gTGFuZ3VhZ2VcbiAgICBpZiAob3B0aW9ucy5sYW5ndWFnZSkge1xuICAgICAgYXNzZXJ0aW9ucy5wdXNoKHRoaXMubGFuZ3VhZ2Uob3B0aW9ucy5sYW5ndWFnZSkpO1xuICAgIH1cblxuICAgIC8vIFRveGljaXR5XG4gICAgaWYgKG9wdGlvbnMubWF4VG94aWNpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgYXNzZXJ0aW9ucy5wdXNoKHRoaXMudG94aWNpdHkob3B0aW9ucy5tYXhUb3hpY2l0eSkpO1xuICAgIH1cblxuICAgIC8vIEN1c3RvbSBjaGVja3NcbiAgICBpZiAob3B0aW9ucy5jdXN0b21DaGVja3MpIHtcbiAgICAgIG9wdGlvbnMuY3VzdG9tQ2hlY2tzLmZvckVhY2goY2hlY2sgPT4ge1xuICAgICAgICBhc3NlcnRpb25zLnB1c2godGhpcy5jdXN0b20oY2hlY2spKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBhc3NlcnRpb25zO1xuICB9XG59XG5cbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSBkZWZhdWx0IGFzc2VydGlvbiBlbmdpbmUgaW5zdGFuY2VcbmltcG9ydCB7IEFzc2VydGlvbkVuZ2luZSB9IGZyb20gJy4vQXNzZXJ0aW9uRW5naW5lJztcblxuZXhwb3J0IGNvbnN0IGFzc2VydGlvbkVuZ2luZSA9IG5ldyBBc3NlcnRpb25FbmdpbmUoKTtcblxuLy8gSW5pdGlhbGl6ZSB0aGUgZ2xvYmFsIGFzc2VydGlvbiBlbmdpbmVcbmFzc2VydGlvbkVuZ2luZS5pbml0aWFsaXplKCkuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbi8vIEV4cG9ydCBhcyBkZWZhdWx0XG5leHBvcnQgZGVmYXVsdCBhc3NlcnRpb25FbmdpbmU7Il0sIm5hbWVzIjpbIkFzc2VydGlvbkVuZ2luZSIsIkFzc2VydGlvblR5cGVSZWdpc3RyeSIsIkFzc2VydGlvblV0aWxzIiwiQ3VzdG9tQXNzZXJ0aW9uVmFsaWRhdG9yIiwiU2VtYW50aWNTaW1pbGFyaXR5VmFsaWRhdG9yIiwiYXNzZXJ0aW9uRW5naW5lIiwiY29udGFpbnMiLCJ2YWx1ZSIsImRlc2NyaXB0aW9uIiwidHlwZSIsImxlbmd0aFJhbmdlIiwibWluIiwibWF4Iiwic2VtYW50aWNTaW1pbGFyaXR5IiwiZXhwZWN0ZWRUZXh0IiwidGhyZXNob2xkIiwic2VudGltZW50IiwiZXhwZWN0ZWRTZW50aW1lbnQiLCJsYW5ndWFnZSIsImV4cGVjdGVkTGFuZ3VhZ2UiLCJ0b3hpY2l0eSIsIm1heFNjb3JlIiwiY3VzdG9tIiwiY29kZSIsImpzb25TY2hlbWEiLCJzY2hlbWEiLCJyZWdleCIsInBhdHRlcm4iLCJmbGFncyIsImNvbmZpZyIsInVuZGVmaW5lZCIsImNvbXByZWhlbnNpdmUiLCJvcHRpb25zIiwiYXNzZXJ0aW9ucyIsInNlbWFudGljVGhyZXNob2xkIiwicHVzaCIsInNlbnRpbWVudEV4cGVjdGVkIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWF4VG94aWNpdHkiLCJjdXN0b21DaGVja3MiLCJmb3JFYWNoIiwiY2hlY2siLCJpbml0aWFsaXplIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Q0FNQzs7Ozs7Ozs7Ozs7UUFHQ0E7ZUFBQUEsZ0NBQWU7O1FBdUJmQztlQUFBQSw0Q0FBcUI7O1FBOERWQztlQUFBQTs7UUFuRVhDO2VBQUFBLGtEQUF3Qjs7UUFSeEJDO2VBQUFBLHdEQUEyQjs7UUFrUGhCQztlQUFBQTs7UUFLYixvQkFBb0I7SUFDcEI7ZUFBQTs7O2lDQWpRTzs2Q0FjQTswQ0FLQTt1Q0FPQTtBQTBEQSxNQUFNSDtJQUNYOztHQUVDLEdBQ0QsT0FBT0ksU0FBU0MsS0FBYSxFQUFFQyxXQUFvQixFQUF5QjtRQUMxRSxPQUFPO1lBQ0xDLE1BQU07WUFDTkY7WUFDQUMsYUFBYUEsZUFBZSxDQUFDLDBCQUEwQixFQUFFRCxNQUFNLENBQUMsQ0FBQztRQUNuRTtJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPRyxZQUFZQyxHQUFXLEVBQUVDLEdBQVcsRUFBRUosV0FBb0IsRUFBeUI7UUFDeEYsT0FBTztZQUNMQyxNQUFNO1lBQ05GLE9BQU8sR0FBR0ksSUFBSSxDQUFDLEVBQUVDLEtBQUs7WUFDdEJKLGFBQWFBLGVBQWUsQ0FBQyxrQ0FBa0MsRUFBRUcsSUFBSSxLQUFLLEVBQUVDLElBQUksV0FBVyxDQUFDO1FBQzlGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE9BQU9DLG1CQUNMQyxZQUFvQixFQUNwQkMsWUFBb0IsR0FBRyxFQUN2QlAsV0FBb0Is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