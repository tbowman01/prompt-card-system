{"version":3,"sources":["/workspaces/prompt-card-system/backend/src/tests/integration/docker-integration.test.ts"],"sourcesContent":["import request from 'supertest';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport assert from 'assert';\n\nconst execAsync = promisify(exec);\n\ninterface DockerService {\n  name: string;\n  container: string;\n  port: number;\n  healthEndpoint: string;\n  expectedResponse?: any;\n}\n\ninterface SystemMetrics {\n  cpu: number;\n  memory: number;\n  networkLatency: number;\n  responseTime: number;\n  throughput: number;\n}\n\ndescribe('Docker Integration Tests - Complete System Verification', () => {\n  const services: DockerService[] = [\n    {\n      name: 'frontend',\n      container: 'prompt-frontend',\n      port: 3000,\n      healthEndpoint: '/api/health'\n    },\n    {\n      name: 'backend',\n      container: 'prompt-backend',\n      port: 3001,\n      healthEndpoint: '/api/health/comprehensive'\n    },\n    {\n      name: 'ollama',\n      container: 'prompt-ollama',\n      port: 11434,\n      healthEndpoint: '/api/version'\n    },\n    {\n      name: 'redis',\n      container: 'prompt-redis',\n      port: 6379,\n      healthEndpoint: '/ping'\n    },\n    {\n      name: 'postgres',\n      container: 'prompt-postgres',\n      port: 5432,\n      healthEndpoint: ''\n    }\n  ];\n\n  let baselineMetrics: SystemMetrics;\n  const testData = {\n    cardId: 'docker-integration-test-card',\n    testExecutionId: '',\n    analyticsSessionId: ''\n  };\n\n  before(async function() {\n    this.timeout(120000); // 2 minutes for setup\n    \n    console.log('ðŸ³ Starting Docker Integration Test Suite');\n    console.log('ðŸ“Š Establishing baseline performance metrics...');\n    \n    // Establish baseline metrics\n    baselineMetrics = await captureSystemMetrics();\n    \n    console.log('âœ… Baseline metrics captured:', baselineMetrics);\n  });\n\n  after(async function() {\n    this.timeout(60000); // 1 minute for cleanup\n    \n    console.log('ðŸ§¹ Cleaning up Docker integration test resources...');\n    await cleanupTestResources();\n  });\n\n  describe('ðŸ¥ Service Health and Connectivity', () => {\n    it('should verify all Docker services are running and healthy', async () => {\n      const healthResults = [];\n      \n      for (const service of services) {\n        const isHealthy = await checkServiceHealth(service);\n        healthResults.push({ service: service.name, healthy: isHealthy });\n        \n        expect(isHealthy).to.be.true; \n        // `Service ${service.name} is not healthy`;\n      }\n      \n      console.log('âœ… All services are healthy:', healthResults);\n    });\n\n    it('should verify inter-service network connectivity', async () => {\n      // Test frontend -> backend connectivity\n      const frontendToBackend = await testNetworkConnectivity(\n        'prompt-frontend', \n        'prompt-backend:3001'\n      );\n      expect(frontendToBackend).to.be.true;\n\n      // Test backend -> ollama connectivity\n      const backendToOllama = await testNetworkConnectivity(\n        'prompt-backend', \n        'prompt-ollama:11434'\n      );\n      expect(backendToOllama).to.be.true;\n\n      // Test backend -> redis connectivity\n      const backendToRedis = await testNetworkConnectivity(\n        'prompt-backend', \n        'prompt-redis:6379'\n      );\n      expect(backendToRedis).to.be.true;\n\n      // Test backend -> postgres connectivity\n      const backendToPostgres = await testNetworkConnectivity(\n        'prompt-backend', \n        'prompt-postgres:5432'\n      );\n      expect(backendToPostgres).to.be.true;\n\n      console.log('âœ… All inter-service network connections verified');\n    });\n\n    it('should verify service startup order and dependencies', async () => {\n      const startupOrder = await getServiceStartupOrder();\n      \n      // Verify postgres started before backend\n      expect(startupOrder.postgres).to.be.below(startupOrder.backend);\n      \n      // Verify redis started before backend\n      expect(startupOrder.redis).to.be.below(startupOrder.backend);\n      \n      // Verify ollama started before backend\n      expect(startupOrder.ollama).to.be.below(startupOrder.backend);\n      \n      // Verify backend started before frontend\n      expect(startupOrder.backend).to.be.below(startupOrder.frontend);\n      \n      console.log('âœ… Service startup order verified:', startupOrder);\n    });\n  });\n\n  describe('ðŸ”„ End-to-End Data Flow', () => {\n    it('should complete full prompt card creation and testing workflow', async () => {\n      // 1. Create a prompt card via API\n      const createResponse = await request(`http://localhost:3001`)\n        .post('/api/prompt-cards')\n        .send({\n          name: 'Docker Integration Test Card',\n          description: 'Test card for Docker integration testing',\n          prompts: [\n            {\n              role: 'user',\n              content: 'What is 2 + 2?'\n            }\n          ],\n          model: 'llama2:7b',\n          parameters: {\n            temperature: 0.1,\n            maxTokens: 100\n          }\n        })\n        .expect(201);\n\n      testData.cardId = createResponse.body.data.id;\n      expect(createResponse.body.success).to.be.true;\n      expect(createResponse.body.data).to.have.property('id');\n\n      // 2. Execute tests on the prompt card\n      const testResponse = await request(`http://localhost:3001`)\n        .post('/api/test-execution')\n        .send({\n          cardId: testData.cardId,\n          testCases: [\n            {\n              id: 'math-test-1',\n              input: 'What is 2 + 2?',\n              expectedOutput: '4'\n            },\n            {\n              id: 'math-test-2', \n              input: 'What is 5 + 3?',\n              expectedOutput: '8'\n            }\n          ],\n          model: 'llama2:7b'\n        })\n        .expect(200);\n\n      testData.testExecutionId = testResponse.body.data.executionId;\n      expect(testResponse.body.success).to.be.true;\n      \n      // 3. Wait for test completion and verify results\n      await waitForTestCompletion(testData.testExecutionId);\n      \n      const resultsResponse = await request(`http://localhost:3001`)\n        .get(`/api/test-execution/${testData.testExecutionId}/results`)\n        .expect(200);\n\n      expect(resultsResponse.body.success).to.be.true;\n      expect(resultsResponse.body.data).to.have.property('testResults');\n      expect(resultsResponse.body.data.testResults).to.be.an('array');\n\n      console.log('âœ… Complete workflow verified successfully');\n    });\n\n    it('should verify real-time WebSocket communication', async () => {\n      const WebSocket = require('ws');\n      const ws = new WebSocket('ws://localhost:3001');\n      \n      let connectionEstablished = false;\n      let progressUpdatesReceived = 0;\n\n      return new Promise((resolve, reject) => {\n        const timeout = setTimeout(() => {\n          reject(new Error('WebSocket test timed out'));\n        }, 30000);\n\n        ws.on('open', () => {\n          connectionEstablished = true;\n          \n          // Subscribe to test execution updates\n          ws.send(JSON.stringify({\n            type: 'subscribe',\n            channel: 'test-execution',\n            executionId: testData.testExecutionId\n          }));\n        });\n\n        ws.on('message', (data: string) => {\n          const message = JSON.parse(data);\n          \n          if (message.type === 'progress' || message.type === 'update') {\n            progressUpdatesReceived++;\n          }\n          \n          if (message.type === 'completed' || progressUpdatesReceived >= 2) {\n            clearTimeout(timeout);\n            expect(connectionEstablished).to.be.true;\n            expect(progressUpdatesReceived).to.be.above(0);\n            ws.close();\n            resolve(undefined);\n          }\n        });\n\n        ws.on('error', (error: Error) => {\n          clearTimeout(timeout);\n          reject(error);\n        });\n      });\n    });\n\n    it('should verify analytics data collection and aggregation', async () => {\n      // Trigger analytics collection\n      const analyticsResponse = await request(`http://localhost:3001`)\n        .post('/api/analytics/collect')\n        .send({\n          event: 'test_execution_completed',\n          cardId: testData.cardId,\n          executionId: testData.testExecutionId,\n          metadata: {\n            testType: 'docker-integration',\n            environment: 'container'\n          }\n        })\n        .expect(200);\n\n      testData.analyticsSessionId = analyticsResponse.body.data.sessionId;\n      \n      // Retrieve analytics data\n      const metricsResponse = await request(`http://localhost:3001`)\n        .get('/api/analytics/metrics')\n        .query({ \n          sessionId: testData.analyticsSessionId,\n          timeRange: '1h'\n        })\n        .expect(200);\n\n      expect(metricsResponse.body.success).to.be.true;\n      expect(metricsResponse.body.data).to.have.property('executionMetrics');\n      expect(metricsResponse.body.data).to.have.property('performanceMetrics');\n\n      console.log('âœ… Analytics data collection verified');\n    });\n  });\n\n  describe('âš¡ Performance and Load Testing', () => {\n    it('should handle concurrent requests across services', async () => {\n      const concurrentRequests = 20;\n      const requests = [];\n      \n      // Create concurrent requests\n      for (let i = 0; i < concurrentRequests; i++) {\n        requests.push(\n          request(`http://localhost:3001`)\n            .get('/api/health/comprehensive')\n            .timeout(10000)\n        );\n        \n        requests.push(\n          request(`http://localhost:3000`)\n            .get('/api/health')\n            .timeout(10000)\n        );\n      }\n\n      const startTime = Date.now();\n      const responses = await Promise.allSettled(requests);\n      const duration = Date.now() - startTime;\n      \n      const successful = responses.filter(r => \n        r.status === 'fulfilled' && r.value.status === 200\n      ).length;\n      \n      const successRate = (successful / responses.length) * 100;\n      \n      expect(successRate).to.be.above(90); // 90% success rate\n      expect(duration).to.be.below(15000); // Under 15 seconds\n      \n      console.log(`âœ… Concurrent load test: ${successRate}% success rate in ${duration}ms`);\n    });\n\n    it('should maintain performance under sustained load', async () => {\n      const loadTestDuration = 30000; // 30 seconds\n      const requestInterval = 500; // 500ms between requests\n      \n      const metricsStart = await captureSystemMetrics();\n      const startTime = Date.now();\n      let requestCount = 0;\n      let successCount = 0;\n      \n      const loadTestPromise = new Promise<void>((resolve) => {\n        const interval = setInterval(async () => {\n          if (Date.now() - startTime >= loadTestDuration) {\n            clearInterval(interval);\n            resolve();\n            return;\n          }\n          \n          requestCount++;\n          try {\n            const response = await request(`http://localhost:3001`)\n              .get('/api/health')\n              .timeout(5000);\n            \n            if (response.status === 200) {\n              successCount++;\n            }\n          } catch (error) {\n            // Request failed\n          }\n        }, requestInterval);\n      });\n      \n      await loadTestPromise;\n      const metricsEnd = await captureSystemMetrics();\n      \n      const successRate = (successCount / requestCount) * 100;\n      const performanceDegradation = calculatePerformanceDegradation(\n        metricsStart, \n        metricsEnd\n      );\n      \n      expect(successRate).to.be.above(85); // 85% success rate under load\n      expect(performanceDegradation).to.be.below(30); // Less than 30% degradation\n      \n      console.log(`âœ… Sustained load test: ${successRate}% success rate, ${performanceDegradation}% performance degradation`);\n    });\n\n    it('should verify container resource utilization', async () => {\n      const resourceMetrics = await getContainerResourceMetrics();\n      \n      // Verify no container is using excessive resources\n      for (const [containerName, metrics] of Object.entries(resourceMetrics)) {\n        expect(metrics.cpuPercent).to.be.below(80); // Less than 80% CPU\n        expect(metrics.memoryPercent).to.be.below(85); // Less than 85% memory\n        \n        console.log(`ðŸ“Š ${containerName}: CPU ${metrics.cpuPercent}%, Memory ${metrics.memoryPercent}%`);\n      }\n      \n      console.log('âœ… Container resource utilization within acceptable limits');\n    });\n  });\n\n  describe('ðŸ›¡ï¸ Security and Error Handling', () => {\n    it('should handle service failures gracefully', async () => {\n      // Temporarily stop Redis to test error handling\n      console.log('ðŸ”„ Testing Redis failure scenario...');\n      await execAsync('docker stop prompt-redis');\n      \n      try {\n        // Backend should still respond but with degraded functionality\n        const response = await request(`http://localhost:3001`)\n          .get('/api/health')\n          .expect(200);\n        \n        expect(response.body).to.have.property('status');\n        // Health check might report degraded status\n        \n        // Test caching functionality (should gracefully degrade)\n        const cacheTestResponse = await request(`http://localhost:3001`)\n          .post('/api/test-execution')\n          .send({\n            cardId: testData.cardId,\n            testCases: [\n              {\n                id: 'cache-test',\n                input: 'Test without Redis',\n                expectedOutput: 'Should work without cache'\n              }\n            ],\n            model: 'llama2:7b'\n          });\n        \n        // Should still work but might be slower\n        expect(cacheTestResponse.status).to.be.oneOf([200, 503]);\n        \n      } finally {\n        // Restart Redis\n        await execAsync('docker start prompt-redis');\n        \n        // Wait for Redis to be ready\n        await new Promise(resolve => setTimeout(resolve, 5000));\n        \n        // Verify Redis is back online\n        const redisHealth = await checkServiceHealth(services.find(s => s.name === 'redis')!);\n        expect(redisHealth).to.be.true;\n      }\n      \n      console.log('âœ… Service failure handling verified');\n    });\n\n    it('should enforce proper security headers and CORS', async () => {\n      const response = await request(`http://localhost:3001`)\n        .get('/api/health')\n        .expect(200);\n      \n      // Check security headers\n      expect(response.headers).to.have.property('x-frame-options');\n      expect(response.headers).to.have.property('x-content-type-options');\n      expect(response.headers['x-content-type-options']).to.equal('nosniff');\n      \n      // Test CORS\n      const corsResponse = await request(`http://localhost:3001`)\n        .options('/api/health')\n        .set('Origin', 'http://localhost:3000')\n        .expect(200);\n      \n      expect(corsResponse.headers['access-control-allow-origin']).to.exist;\n      \n      console.log('âœ… Security headers and CORS verified');\n    });\n\n    it('should handle database connection issues', async () => {\n      // Test database connection resilience\n      const dbTestResponse = await request(`http://localhost:3001`)\n        .get('/api/prompt-cards')\n        .expect(200);\n      \n      expect(dbTestResponse.body.success).to.be.true;\n      \n      // Verify database is properly connected\n      const dbHealthResponse = await request(`http://localhost:3001`)\n        .get('/api/health/database')\n        .expect(200);\n      \n      expect(dbHealthResponse.body.database).to.have.property('connected');\n      expect(dbHealthResponse.body.database.connected).to.be.true;\n      \n      console.log('âœ… Database connection handling verified');\n    });\n  });\n\n  describe('ðŸ“Š Monitoring and Observability', () => {\n    it('should provide comprehensive health monitoring', async () => {\n      const healthResponse = await request(`http://localhost:3001`)\n        .get('/api/health/comprehensive')\n        .expect(200);\n      \n      expect(healthResponse.body).to.have.property('status');\n      expect(healthResponse.body).to.have.property('timestamp');\n      expect(healthResponse.body).to.have.property('services');\n      expect(healthResponse.body).to.have.property('database');\n      expect(healthResponse.body).to.have.property('cache');\n      expect(healthResponse.body).to.have.property('llm');\n      expect(healthResponse.body).to.have.property('system');\n      \n      // Verify all service statuses\n      expect(healthResponse.body.services.backend).to.equal('healthy');\n      expect(healthResponse.body.database.connected).to.be.true;\n      expect(healthResponse.body.cache.connected).to.be.true;\n      expect(healthResponse.body.llm.available).to.be.true;\n      \n      console.log('âœ… Comprehensive health monitoring verified');\n    });\n\n    it('should collect and export metrics for monitoring', async () => {\n      const metricsResponse = await request(`http://localhost:3001`)\n        .get('/api/metrics')\n        .expect(200);\n      \n      // Should return Prometheus-format metrics\n      expect(metricsResponse.text).to.include('# HELP');\n      expect(metricsResponse.text).to.include('# TYPE');\n      expect(metricsResponse.text).to.include('http_requests_total');\n      expect(metricsResponse.text).to.include('process_cpu_user_seconds_total');\n      \n      console.log('âœ… Metrics collection and export verified');\n    });\n  });\n\n  // Helper Functions\n  async function checkServiceHealth(service: DockerService): Promise<boolean> {\n    try {\n      if (service.name === 'redis') {\n        const { stdout } = await execAsync(`docker exec ${service.container} redis-cli ping`);\n        return stdout.trim() === 'PONG';\n      }\n      \n      if (service.name === 'postgres') {\n        const { stdout } = await execAsync(`docker exec ${service.container} pg_isready -U promptcard -d promptcard_dev`);\n        return stdout.includes('accepting connections');\n      }\n      \n      const response = await request(`http://localhost:${service.port}`)\n        .get(service.healthEndpoint)\n        .timeout(10000);\n      \n      return response.status === 200;\n    } catch (error) {\n      console.error(`Health check failed for ${service.name}:`, error.message);\n      return false;\n    }\n  }\n\n  async function testNetworkConnectivity(fromContainer: string, toAddress: string): Promise<boolean> {\n    try {\n      const command = `docker exec ${fromContainer} sh -c \"nc -z ${toAddress.split(':')[0]} ${toAddress.split(':')[1]}\"`;\n      await execAsync(command);\n      return true;\n    } catch (error) {\n      console.error(`Network connectivity test failed from ${fromContainer} to ${toAddress}:`, error.message);\n      return false;\n    }\n  }\n\n  async function getServiceStartupOrder(): Promise<Record<string, number>> {\n    const order: Record<string, number> = {};\n    \n    for (const service of services) {\n      try {\n        const { stdout } = await execAsync(`docker inspect ${service.container} --format='{{.State.StartedAt}}'`);\n        order[service.name] = new Date(stdout.trim()).getTime();\n      } catch (error) {\n        order[service.name] = 0;\n      }\n    }\n    \n    return order;\n  }\n\n  async function captureSystemMetrics(): Promise<SystemMetrics> {\n    try {\n      // CPU usage\n      const cpuInfo = await execAsync(\"docker stats --no-stream --format 'table {{.CPUPerc}}' | tail -n +2 | head -1\");\n      const cpu = parseFloat(cpuInfo.stdout.replace('%', '')) || 0;\n      \n      // Memory usage\n      const memInfo = await execAsync(\"docker stats --no-stream --format 'table {{.MemPerc}}' | tail -n +2 | head -1\");\n      const memory = parseFloat(memInfo.stdout.replace('%', '')) || 0;\n      \n      // Network latency (ping to backend)\n      const latencyStart = Date.now();\n      await request('http://localhost:3001').get('/api/health').timeout(5000);\n      const networkLatency = Date.now() - latencyStart;\n      \n      // Response time for a standard request\n      const responseStart = Date.now();\n      await request('http://localhost:3001').get('/api/prompt-cards').timeout(10000);\n      const responseTime = Date.now() - responseStart;\n      \n      // Throughput (requests per second) - simple estimation\n      const throughputStart = Date.now();\n      const requests = Array(10).fill(null).map(() => \n        request('http://localhost:3001').get('/api/health').timeout(5000)\n      );\n      await Promise.all(requests);\n      const throughputDuration = Date.now() - throughputStart;\n      const throughput = (10 / throughputDuration) * 1000; // requests per second\n      \n      return {\n        cpu,\n        memory,\n        networkLatency,\n        responseTime,\n        throughput\n      };\n    } catch (error) {\n      console.warn('Failed to capture complete system metrics:', error.message);\n      return {\n        cpu: 0,\n        memory: 0,\n        networkLatency: 1000,\n        responseTime: 1000,\n        throughput: 0\n      };\n    }\n  }\n\n  async function waitForTestCompletion(executionId: string, timeout: number = 60000): Promise<void> {\n    const startTime = Date.now();\n    \n    while (Date.now() - startTime < timeout) {\n      try {\n        const response = await request(`http://localhost:3001`)\n          .get(`/api/test-execution/${executionId}/status`)\n          .timeout(5000);\n        \n        if (response.body.data.status === 'completed' || response.body.data.status === 'failed') {\n          return;\n        }\n        \n        await new Promise(resolve => setTimeout(resolve, 2000));\n      } catch (error) {\n        await new Promise(resolve => setTimeout(resolve, 2000));\n      }\n    }\n    \n    throw new Error(`Test execution ${executionId} did not complete within ${timeout}ms`);\n  }\n\n  function calculatePerformanceDegradation(start: SystemMetrics, end: SystemMetrics): number {\n    const responseTimeDegradation = ((end.responseTime - start.responseTime) / start.responseTime) * 100;\n    const throughputDegradation = ((start.throughput - end.throughput) / start.throughput) * 100;\n    \n    return Math.max(responseTimeDegradation, throughputDegradation);\n  }\n\n  async function getContainerResourceMetrics(): Promise<Record<string, { cpuPercent: number; memoryPercent: number }>> {\n    const metrics: Record<string, { cpuPercent: number; memoryPercent: number }> = {};\n    \n    try {\n      const { stdout } = await execAsync(\"docker stats --no-stream --format 'table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemPerc}}'\");\n      const lines = stdout.split('\\n').slice(1); // Skip header\n      \n      for (const line of lines) {\n        if (line.trim()) {\n          const [name, cpu, memory] = line.split('\\t');\n          metrics[name] = {\n            cpuPercent: parseFloat(cpu.replace('%', '')),\n            memoryPercent: parseFloat(memory.replace('%', ''))\n          };\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to get container resource metrics:', error.message);\n    }\n    \n    return metrics;\n  }\n\n  async function cleanupTestResources(): Promise<void> {\n    try {\n      // Clean up test data\n      if (testData.cardId && testData.cardId !== 'docker-integration-test-card') {\n        await request(`http://localhost:3001`)\n          .delete(`/api/prompt-cards/${testData.cardId}`)\n          .timeout(5000);\n      }\n      \n      // Clean up test executions\n      if (testData.testExecutionId) {\n        await request(`http://localhost:3001`)\n          .delete(`/api/test-execution/${testData.testExecutionId}`)\n          .timeout(5000);\n      }\n      \n      console.log('âœ… Test resources cleaned up');\n    } catch (error) {\n      console.warn('Failed to clean up some test resources:', error.message);\n    }\n  }\n});"],"names":["execAsync","promisify","exec","describe","services","name","container","port","healthEndpoint","baselineMetrics","testData","cardId","testExecutionId","analyticsSessionId","before","timeout","console","log","captureSystemMetrics","after","cleanupTestResources","it","healthResults","service","isHealthy","checkServiceHealth","push","healthy","expect","to","be","true","frontendToBackend","testNetworkConnectivity","backendToOllama","backendToRedis","backendToPostgres","startupOrder","getServiceStartupOrder","postgres","below","backend","redis","ollama","frontend","createResponse","request","post","send","description","prompts","role","content","model","parameters","temperature","maxTokens","body","data","id","success","have","property","testResponse","testCases","input","expectedOutput","executionId","waitForTestCompletion","resultsResponse","get","testResults","an","WebSocket","require","ws","connectionEstablished","progressUpdatesReceived","Promise","resolve","reject","setTimeout","Error","on","JSON","stringify","type","channel","message","parse","clearTimeout","above","close","undefined","error","analyticsResponse","event","metadata","testType","environment","sessionId","metricsResponse","query","timeRange","concurrentRequests","requests","i","startTime","Date","now","responses","allSettled","duration","successful","filter","r","status","value","length","successRate","loadTestDuration","requestInterval","metricsStart","requestCount","successCount","loadTestPromise","interval","setInterval","clearInterval","response","metricsEnd","performanceDegradation","calculatePerformanceDegradation","resourceMetrics","getContainerResourceMetrics","containerName","metrics","Object","entries","cpuPercent","memoryPercent","cacheTestResponse","oneOf","redisHealth","find","s","headers","equal","corsResponse","options","set","exist","dbTestResponse","dbHealthResponse","database","connected","healthResponse","cache","llm","available","text","include","stdout","trim","includes","fromContainer","toAddress","command","split","order","getTime","cpuInfo","cpu","parseFloat","replace","memInfo","memory","latencyStart","networkLatency","responseStart","responseTime","throughputStart","Array","fill","map","all","throughputDuration","throughput","warn","start","end","responseTimeDegradation","throughputDegradation","Math","max","lines","slice","line","delete"],"mappings":"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"}